[stream]
# Usage: `mpv --profile=stream video.mp4`
# Use a large, dynamically-growing memory cache. Starts at 150MB, can grow to 500MB.
# This is the most important setting for preventing buffering.
demuxer-max-bytes=500M
demuxer-max-back-bytes=50M
demuxer-readahead-secs=600
cache=yes
cache-on-disk=no
demuxer-thread=yes

gpu-api=vulkan
hwdec=auto-safe # This will now successfully pick d3d11va and work with Vulkan
vulkan-device=00000000-0500-0000-0000-000000000000

# cache-pause=no
# --- Disable legacy caching options to prevent any other conflicts ---
# cache-secs=600
# cache-bytes=0

# For live streams or slow connections, force a smaller initial cache fill before playback.
# (Optional, uncomment if needed)
# cache-initial=2M

# Increase the timeout for seeking on slow network streams.
demuxer-seekable-cache=yes

# -- Playback and Quality --
# Enable hardware decoding to save CPU. 'auto-safe' is a good balance.
# Use adaptive streaming (DASH/HLS) to automatically select the best quality.
# This lets the player choose the best bitrate based on your connection speed.
ytdl-format="bestvideo[height<=?1080]+bestaudio/best"
# For very low-latency live streams (e.g., Twitch), you might add this.
# Reduces latency but makes you more vulnerable to network stutters.
# profile=low-latency
video-sync=display-resample  # Best for smooth frame timing
interpolation=yes            # Motion interpolation (optional)
tscale=oversample            # For smooth motion (used with interpolation)
# tone-mapping=auto
hdr-compute-peak=yes
target-prim=bt.709
target-trc=srgb
tone-mapping=bt.2446a
target-contrast=1100
#tone-mapping=hable
# target-peak=300


# -- Network and Demuxer Tweaks --

# --- Resilience & Automatic Error Recovery ---
# [1] Set a global timeout to prevent the player from hanging on a stalled connection.
# After 15 seconds of no data, an error will be triggered.
network-timeout=15

# [2] Configure the FFmpeg demuxer to aggressively reconnect on errors.
# This tells it what to do when the timeout from above is hit.
# demuxer-lavf-o-add=reconnect=1
# demuxer-lavf-o-add=reconnect_on_network_error=1
# demuxer-lavf-o-add=reconnect_on_http_error=4xx,5xx
# demuxer-lavf-o-add=reconnect_streamed=1
# demuxer-lavf-o-add=reconnect_delay_max=45

demuxer-lavf-o-append=reconnect=1
demuxer-lavf-o-append=reconnect_streamed=1
demuxer-lavf-o-append=reconnect_on_network_error=1
demuxer-lavf-o-append=reconnect_on_http_error=4xx,5xx
demuxer-lavf-o-append=reconnect_delay_max=45

# [3] Proactively keep the cache filled using hysteresis.
# If the playable buffer drops below 60 seconds, force the demuxer to
# start reading again. This acts as a secondary "kick" to un-stick a stall.
demuxer-hysteresis-secs=60